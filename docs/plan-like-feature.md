# 좋아요 기능 개발 계획

## 목표

PRD.md의 "1-4. 홈 피드 - 좋아요 기능" 및 "7.3 좋아요" 섹션 요구사항 완료 및 개선

## 현재 구현 상태

### ✅ 완료된 작업

1. **데이터베이스**
   - ✅ `likes` 테이블 생성 (db.sql)
   - ✅ UNIQUE 제약 조건으로 중복 좋아요 방지
   - ✅ 인덱스 생성 (post_id, user_id)

2. **API Routes**
   - ✅ `/api/likes` POST: 좋아요 추가
   - ✅ `/api/likes` DELETE: 좋아요 취소
   - ✅ Clerk 인증 확인
   - ✅ 중복 좋아요 방지 처리

3. **PostCard 컴포넌트**
   - ✅ 좋아요 버튼 구현 (빈 하트 ↔ 빨간 하트)
   - ✅ 좋아요 상태 관리 (isLiked)
   - ✅ 좋아요 수 표시 및 업데이트
   - ✅ Optimistic Update 구현
   - ✅ 더블탭 좋아요 기능

4. **애니메이션**
   - ✅ 좋아요 클릭 애니메이션 (heartScale)
   - ✅ 더블탭 하트 애니메이션 (doubleTapHeart)

## 개선 및 완성 작업

### 1. 애니메이션 타이밍 개선

**현재 상태**: 기본 애니메이션 구현됨

**개선 사항**:
- PRD 요구사항: 클릭 시 scale(1.3) → 0.15초 후 scale(1)
- 현재 구현 확인 및 타이밍 정확도 개선

**파일**: `components/post/post-card.tsx`, `app/globals.css`

**작업 내용**:
- `heartScale` 애니메이션 타이밍 확인 및 조정
- CSS 애니메이션 duration을 0.3s에서 0.15s로 조정 (PRD 요구사항)
- 더블탭 하트 애니메이션 타이밍 확인 (1초 후 사라짐)

### 2. 좋아요 버튼 접근성 개선

**현재 상태**: 기본 aria-label 구현됨

**개선 사항**:
- 키보드 접근성 개선
- 포커스 상태 스타일 추가
- 로딩 상태 표시 (선택사항)

**파일**: `components/post/post-card.tsx`

**작업 내용**:
- 키보드 이벤트 처리 (Enter/Space 키)
- 포커스 링 스타일 추가
- 로딩 중 버튼 비활성화 (중복 클릭 방지)

### 3. 에러 처리 개선

**현재 상태**: 기본 에러 처리 및 롤백 구현됨

**개선 사항**:
- 사용자 친화적인 에러 메시지
- 네트워크 오류 처리
- 재시도 로직 (선택사항)

**파일**: `components/post/post-card.tsx`

**작업 내용**:
- 에러 발생 시 토스트 메시지 표시 (선택사항)
- 네트워크 오류 감지 및 처리
- Optimistic Update 실패 시 명확한 롤백

### 4. 좋아요 수 실시간 동기화

**현재 상태**: Optimistic Update로 즉시 업데이트됨

**개선 사항**:
- 서버 응답 후 실제 좋아요 수 동기화
- 여러 사용자가 동시에 좋아요한 경우 정확한 수치 반영

**파일**: `components/post/post-card.tsx`, `app/api/likes/route.ts`

**작업 내용**:
- API 응답에 업데이트된 좋아요 수 포함 (선택사항)
- 또는 좋아요 후 게시물 데이터 재조회 (선택사항)

### 5. 더블탭 감지 개선

**현재 상태**: 기본 더블탭 감지 구현됨

**개선 사항**:
- 더블탭 감지 정확도 향상
- 모바일 터치 이벤트 최적화
- 데스크톱에서는 더블탭 비활성화 (선택사항)

**파일**: `components/post/post-card.tsx`

**작업 내용**:
- 더블탭 감지 로직 개선
- 모바일/데스크톱 구분하여 처리
- 터치 이벤트와 마우스 이벤트 분리

### 6. 좋아요 목록 조회 기능 (선택사항)

**PRD 요구사항**: 1차 MVP 제외 기능

**향후 확장**:
- 좋아요 수 클릭 시 좋아요한 사용자 목록 모달 표시
- `/api/posts/[postId]/likes` API 구현

## 구현 세부사항

### 애니메이션 타이밍

**좋아요 클릭 애니메이션** (PRD 요구사항):
```css
@keyframes heartScale {
  0% { transform: scale(1); }
  50% { transform: scale(1.3); }  /* 0.15초 시점 */
  100% { transform: scale(1); }    /* 0.3초 완료 */
}
```

**더블탭 하트 애니메이션** (PRD 요구사항):
```css
@keyframes doubleTapHeart {
  0% { opacity: 0; transform: scale(0); }      /* fade in 시작 */
  20% { opacity: 1; transform: scale(1.2); }   /* fade in 완료 */
  100% { opacity: 0; transform: scale(1.5); }  /* 1초 후 fade out */
}
```

### 상태 관리

**Optimistic Update 플로우**:
1. 사용자 클릭 → 즉시 UI 업데이트 (isLiked, likesCount)
2. API 호출 (POST/DELETE)
3. 성공 시: 상태 유지
4. 실패 시: 이전 상태로 롤백

### 에러 처리

**에러 시나리오**:
1. 네트워크 오류: 롤백 + 에러 메시지
2. 인증 오류: 로그인 페이지로 리다이렉트
3. 중복 좋아요: 무시 (이미 처리됨)
4. 서버 오류: 롤백 + 재시도 옵션

## 검증 방법

1. ✅ 좋아요 버튼 클릭 시 즉시 UI 업데이트 확인
2. ✅ 좋아요 애니메이션이 올바른 타이밍으로 작동하는지 확인
3. ✅ 더블탭 좋아요가 모바일에서 정상 작동하는지 확인
4. ✅ API 호출 실패 시 롤백이 정상 작동하는지 확인
5. ✅ 중복 좋아요 방지가 작동하는지 확인
6. ✅ 좋아요 수가 정확하게 업데이트되는지 확인
7. ✅ 키보드 접근성이 작동하는지 확인

## 참고 파일

- `docs/PRD.md`: 좋아요 기능 요구사항
- `supabase/migrations/20251208142024_initial_sns_schema.sql`: likes 테이블 스키마
- `app/api/likes/route.ts`: 좋아요 API 구현
- `components/post/post-card.tsx`: PostCard 컴포넌트
- `app/globals.css`: 애니메이션 스타일

## 완료 상태

### 기본 기능: ✅ 완료

- ✅ 좋아요 추가/취소 API
- ✅ 좋아요 버튼 UI
- ✅ 좋아요 애니메이션
- ✅ 더블탭 좋아요
- ✅ Optimistic Update

### 개선 사항: 선택적

- [ ] 애니메이션 타이밍 정확도 개선
- [ ] 접근성 개선 (키보드, 포커스)
- [ ] 에러 처리 개선
- [ ] 더블탭 감지 개선

## 결론

좋아요 기능의 기본 구현이 완료되었습니다. PRD의 핵심 요구사항을 모두 충족하며, 추가 개선 사항은 선택적으로 진행할 수 있습니다.

