-- ============================================
-- Supabase Storage 버킷 생성 (단계별 실행)
-- 
-- 사용 방법:
-- 1. Supabase Dashboard → SQL Editor 열기
-- 2. 아래 각 단계를 하나씩 복사하여 실행
-- 3. 각 단계가 성공하면 다음 단계로 진행
-- ============================================

-- ============================================
-- 단계 1: 기존 버킷 확인
-- ============================================
-- 먼저 버킷이 이미 존재하는지 확인
SELECT * FROM storage.buckets WHERE id = 'posts';

-- ============================================
-- 단계 2: 버킷 생성 (최소 옵션)
-- ============================================
-- 이 단계만 실행해보세요. 성공하면 단계 3으로 넘어가세요.
INSERT INTO storage.buckets (id, name, public)
VALUES ('posts', 'posts', true);

-- 만약 "duplicate key" 오류가 나면 버킷이 이미 존재하는 것입니다.
-- 그럼 단계 3으로 넘어가세요.

-- ============================================
-- 단계 3: 버킷 설정 업데이트 (선택사항)
-- ============================================
-- 버킷이 이미 존재하거나 단계 2가 성공했다면, 이 단계로 설정을 업데이트하세요.
UPDATE storage.buckets
SET
  public = true,
  file_size_limit = 5242880
WHERE id = 'posts';

-- ============================================
-- 단계 4: MIME 타입 제한 추가 (선택사항)
-- ============================================
-- 이미지 파일만 허용하도록 설정
UPDATE storage.buckets
SET allowed_mime_types = ARRAY['image/jpeg', 'image/jpg', 'image/png', 'image/webp']
WHERE id = 'posts';

-- ============================================
-- 단계 5: 최종 확인
-- ============================================
SELECT 
  id, 
  name, 
  public, 
  file_size_limit, 
  allowed_mime_types,
  created_at
FROM storage.buckets 
WHERE id = 'posts';

